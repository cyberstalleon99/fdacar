{% load static %}
<!-- JavaScript files-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.2/b-colvis-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/fh-3.1.7/kt-2.5.2/r-2.2.4/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.0/sl-1.3.1/datatables.min.js"></script>

<script src="{% static 'darkadmin/vendor/popper.js/umd/popper.min.js' %}"> </script>
<script src="{% static 'darkadmin/vendor/bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'darkadmin/vendor/jquery.cookie/jquery.cookie.js' %}"> </script>
<script src="{% static 'darkadmin/vendor/chart.js/Chart.min.js' %}"></script>
<script src="{% static 'darkadmin/vendor/jquery-validation/jquery.validate.min.js' %}"></script>
<script src="{% static 'darkadmin/js/charts-custom.js' %}"></script>
<script src="{% static 'darkadmin/js/front.js' %}"></script>


<script>
$(document).ready(function () {
    var table = $('#establishment_list').DataTable ({
        'serverSide': true,
        'processing': true,
        'pageLength': 20,
        'ajax': '/api/establishment-list/estabs/?format=datatables',
        'searching': true,
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        'columns': [
              {
                  'data': 'name',
                  'name': 'name',
                  'render': function(data, type, row, meta){
                      if(type === 'display') {
                          var url = "{% url 'masterlist:est-detail' 0 %}";
                          var id = row.DT_RowAttr.pkey;
                          url = url.replace(0, id);
                          data = '<a href="' + url + '">' + data + '</a>';
                      }
                      return data;
                  }
              },
              {
                  'data': 'plant_address',
                  'name': 'plant_address.address'

              },
              {
                  'data': 'product_type.name',
                  'name': 'product_type.name'
              },
              {
                  'data': 'primary_activity',
                  'name': 'primary_activity.name',

              },
              {
                  'data': 'specific_activities',
                  'name': 'specific_activity.name',

              },
              {
                  'data': 'ltos.0.lto_number',
                  'name': 'ltos.lto_number',
                //   'searchable': false

              },
              {
                  'data': 'ltos.0.expiry',
                  'name': 'ltos.0.expiry',
                  'searchable': false

              },
              {
                  'data': 'duration',
                  'searchable': false,
                  "sortable": false
              },
              {
                  'data': 'folder_number',
                  'name': 'record.folder_id'
              },
        ],
        // dom: 'B<"clear"lfrtip>',
        dom: 'B<fl<t>ip>',
        buttons: {
           name: 'primary',
           buttons: ['copy', 'csv', 'excel', 'pdf']
       },
    });

    $('.btn-est').on('click', function() {
        table.columns().search('');
        var rel = $(this).attr('rel');
        if (rel) {
            table.columns(2).search(rel).draw();
        } else {
            table.draw();
        }
    });

    $('.btn-inactive').on('click', function() {
        table.columns().search('');
        var rel = $(this).attr('rel');
        if (rel) {
            table.columns(2).search(rel).draw();
        } else {
            table.draw();
        }
    });
});

// $(document).ready(function () {
//     $('#food_list').dataTable ({
//       dom: 'B<"clear"lfrtip>',
//       buttons: {
//           name: 'primary',
//           buttons: ['copy', 'csv', 'excel', 'pdf']
//       },
//       pageLength: 20
//     });
// });
</script>

<script>
$("#id_region").change(function() {
    var url = $("#plantaddressform").attr("data-provinces-url");
    var regionId = $(this).val();

    $.ajax({
        url: url,
        data: {
            'region': regionId
        },
        success: function(data) {
            $("#id_province").html(data);
        }
    });
});

$("#id_province").change(function() {
    var url = $("#plantaddressform").attr("data-cities-url");
    var provinceId = $(this).val();

    $.ajax({
        url: url,
        data: {
            'province': provinceId
        },
        success: function(data) {
            $("#id_municipality_or_city").html(data);
        }
    });
});


$("#id_product_type").change(function() {
    var url = $("#steponeform").attr("data-productlines-url");
    var productTypeId = $(this).val();

    $.ajax({
        url: url,
        data: {
            'productType': productTypeId
        },
        success: function(data) {
            $("#id_product_line").html(data);
        }
    });
});
</script>
