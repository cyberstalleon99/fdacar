{% extends 'masterlist/partial/base.html' %}
{% block title %} {{establishment.name}}  {% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4">
        <div class="user-block block text-center">
            <div class="avatar">
                <img src="/static/masterlist/img/under_construction_logo.jpg" alt="..." class="img-fluid">
                <!--                <div class="order dashbg-1">2nd</div>-->
            </div>
            <a href="#" class="user-title">
                <h3 class="h5">{{establishment.name}}</h3>
                <span>{{establishment.authorizedofficer.full_name}}</span> <br />
                <br />
                {% for spec_act in establishment.specific_activity.all %}
                <span>{{spec_act.name}}</span><br>
                {% endfor %}
            </a>
            <div class="contributions">{{establishment.ltos.first.lto_number}} <br> {{establishment.ltos.first.expiry.date}}</div> <br><br/>
            <a href="{% url 'admin:masterlist_establishment_change' establishment.id %}" target="_blank">Update</a><br/>
            <a href="#">Add branch</a>
            <div class="details d-flex">
              <div class="item" data-toggle="tooltip" title="Number of Inspections"><i class="icon-info"></i><strong>{{establishment.inspection_set.all.count}}</strong></div>
              <div class="item" data-toggle="tooltip" title="Month/s before expiration"><i class="fa fa-gg"></i><strong>{{establishment.lto.get_duration}}</strong></div>
              <div class="item" data-toggle="tooltip" title="Status"><i class="icon-flow-branch"></i><strong>{{establishment.status}}</strong></div>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="user-block block text-center">
            <div class="title text-left">
                <strong>Information</strong>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <tbody>
                    <tr>
                        <th scope="row" class="text-left">Product Type</th>
                        <td class="text-left">{{establishment.product_type}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Primary Activity</th>
                        <td class="text-left">{{establishment.primary_activity}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Product Line</th>
                        <td class="text-left">{{establishment.product_line}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Remarks</th>
                        <td class="text-left">{{establishment.remarks}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Additional Activity</th>
                        <td class="text-left">{{establishment.additional_activity}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Plant Address</th>
                        <td class="text-left">{{establishment.plant_address.full_address}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Warehouse Address</th>
                        <td class="text-left">
                          {% for warehouse in establishment.warehouses.all %}
                          {{warehouse.full_address}} <br/>
                          {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Office Address</th>
                        <td class="text-left">{{establishment.office_address.full_address}}</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Authorized Officer</th>
                        <td class="text-left">{{establishment.authorized_officer.full_name}} ({{establishment.authorized_officer.email}}, {{establishment.authorized_officer.mobile}})</td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-left">Qualified Personnel</th>
                        {% if establishment.qualifiedperson_set.all %}
                          {% for qualified_person in establishment.qualifiedperson_set.all %}
                          <td class="text-left">{{qualified_person}} ({{qualified_person.email}}, {{qualified_person.mobile}})</td>
                          {% endfor %}
                        {% else %}
                          <td class="text-left">None</td>
                        {% endif %}
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="block">
            <div class="title">
                <strong>List of Inspections</strong>  <a href="{% url 'admin:masterlist_inspection_add' %}" target="_blank">Add an Inspection</a>
            </div>
            <div class="block-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>Date Inspected</th>
                            <th>No. of CAPA</th>
                            <th>Inspected by</th>
                            <th>Type</th>
                            <th>Frequency</th>
                            <th>Followup</th>
                            <th>Remarks</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if inspections %}
                        {% for inspection in inspections %}
                        <tr>
                            <td><a href="{% url 'admin:masterlist_inspection_change' inspection.id %}" target="_blank">{{inspection.date_inspected.date}}</a></td>
                            {% if inspection.capa %}
                            <td><a href="{% url 'admin:masterlist_capa_change' inspection.capa.id %}" target="_blank">{{inspection.capa.capadeficiency_set.all.count}}</a></td>
                            {% else %}
                            <td>None</td>
                            {% endif %}
                            <td>{{inspection.inspector}}</td>
                            <td>{{inspection.type_of_inspection}}</td>
                            <td>{{inspection.frequency_of_inspection}}</td>
                            <td>{{inspection.date_of_followup_inspection.date}}</td>
                            <td>{{inspection.remarks}}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        No inspections yet
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
